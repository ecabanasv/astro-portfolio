<!-- src/components/Head.astro -->
---
import { siteMetadata } from '../data/head';

const {
  title: incomingTitle,
  description: incomingDescription,
  url: incomingUrl,
  image: incomingImage,
  icon: incomingIcon,
  fonts: incomingFonts,
  jsonLdPerson: incomingJsonLd,
} = Astro.props;

const ensureAbsoluteUrl = (value: string) => {
  try {
    return new URL(value, siteMetadata.url).toString();
  } catch {
    return value;
  }
};

const title = incomingTitle ?? siteMetadata.title;
const description = incomingDescription ?? siteMetadata.description;
const defaultCanonical = new URL(Astro.url.pathname, siteMetadata.url).toString();
const url = ensureAbsoluteUrl(incomingUrl ?? defaultCanonical);
const image = ensureAbsoluteUrl(incomingImage ?? siteMetadata.image);
const icon = incomingIcon ?? siteMetadata.icon;
const fonts = incomingFonts ?? siteMetadata.fonts;
const jsonLdPerson = {
  ...siteMetadata.jsonLdPerson,
  ...(incomingJsonLd ?? {}),
};
---
<>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{title}</title>
  <meta name="description" content={description} />
  <link rel="canonical" href={url} />
  {fonts?.map(font => (
    <link key={`${font.rel}-${font.href}`} rel={font.rel} href={font.href} crossorigin={font.crossorigin} />
  ))}
  <!-- OG / Twitter -->
  <meta property="og:title" content={title} />
  <meta property="og:description" content={description} />
  <meta property="og:type" content="website" />
  <meta property="og:url" content={url} />
  <meta property="og:image" content={image} />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content={title} />
  <meta name="twitter:description" content={description} />
  <meta name="twitter:image" content={image} />
  <link rel="icon" href={icon} />
  {jsonLdPerson && (
    <script type="application/ld+json">
      {JSON.stringify(jsonLdPerson, null, 2)}
    </script>
  )}
</>
