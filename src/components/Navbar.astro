---
import { siteMetadata } from "../data/head";
import ThemeToggle from "./ThemeToggle.astro";

const links = [
  { href: "#about", label: "About" },
  { href: "#resume", label: "Resume" },
  { href: "#portfolio", label: "Portfolio" },
  { href: "#blog", label: "Blog" },
  { href: "#contact", label: "Contact" },
];

const homeHref = "/";
---

<header
  class="sticky top-0 z-50 w-full border-b border-border/40 bg-background/80 backdrop-blur-md transition-colors"
>
  <div class="container flex h-16 items-center justify-between">
    <a
      href={homeHref}
      class="flex items-center gap-2 font-display text-lg font-bold tracking-tight text-text hover:text-primary transition-colors"
    >
      {siteMetadata.title || "Portfolio"}
    </a>

    <!-- Desktop Navigation -->
    <nav
      class="hidden md:flex md:items-center md:gap-6"
      aria-label="Main navigation"
    >
      {
        links.map((link) => (
          <a
            href={link.href}
            class="text-sm font-medium text-text-muted hover:text-primary transition-colors"
          >
            {link.label}
          </a>
        ))
      }
      <div class="pl-2 border-l border-border ml-2">
        <ThemeToggle />
      </div>
    </nav>

    <!-- Mobile Menu Button -->
    <div class="flex items-center gap-4 md:hidden">
      <ThemeToggle />
      <button
        type="button"
        id="mobile-menu-btn"
        class="inline-flex items-center justify-center rounded-md p-2 text-text-muted hover:bg-surface-muted hover:text-text focus:outline-none focus:ring-2 focus:ring-primary"
        aria-controls="mobile-menu"
        aria-expanded="false"
        aria-label="Toggle menu"
      >
        <span class="sr-only">Open main menu</span>
        <svg
          class="h-6 w-6"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path>
        </svg>
      </button>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div class="md:hidden hidden" id="mobile-menu">
    <div class="space-y-1 px-4 pb-3 pt-2 border-t border-border bg-background">
      {
        links.map((link) => (
          <a
            href={link.href}
            class="block rounded-md px-3 py-2 text-base font-medium text-text-muted hover:bg-surface-muted hover:text-primary"
          >
            {link.label}
          </a>
        ))
      }
    </div>
  </div>
</header>

<script>
  const btn = document.getElementById("mobile-menu-btn");
  const menu = document.getElementById("mobile-menu");

  if (btn && menu) {
    const toggleMenu = () => {
      const isExpanded = btn.getAttribute("aria-expanded") === "true";
      btn.setAttribute("aria-expanded", (!isExpanded).toString());
      menu.classList.toggle("hidden");
    };

    btn.addEventListener("click", (e) => {
      e.stopPropagation();
      toggleMenu();
    });

    // Close on click outside
    document.addEventListener("click", (event) => {
      if (
        !menu.classList.contains("hidden") &&
        !menu.contains(event.target as Node) &&
        !btn.contains(event.target as Node)
      ) {
        btn.setAttribute("aria-expanded", "false");
        menu.classList.add("hidden");
      }
    });

    // Close on Escape key
    document.addEventListener("keydown", (event) => {
      if (event.key === "Escape" && !menu.classList.contains("hidden")) {
        btn.setAttribute("aria-expanded", "false");
        menu.classList.add("hidden");
        btn.focus();
      }
    });
  }
</script>
